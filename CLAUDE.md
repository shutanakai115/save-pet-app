# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 言語設定
- 常に日本語で会話する
- コメントも日本語で記述する
- エラーメッセージの説明も日本語で行う
- ドキュメントも日本語で生成する

## Commands

```bash
# Development
pnpm dev            # Run all apps in parallel (web + api)
pnpm dev:web        # Next.js dev server only (Turbopack)
pnpm dev:api        # Go API server only

# Build
pnpm build          # Build all apps
pnpm build:web      # Build Next.js app

# Code quality
pnpm lint           # oxlint across all apps
pnpm format         # oxfmt across all apps

# Testing (Storybook + Vitest browser tests via Playwright/Chromium)
pnpm test           # Run all tests
pnpm --filter @saving-pet/web test  # Web tests only

# Storybook
pnpm storybook      # Storybook dev server on port 6006

# Panda CSS
pnpm --filter @saving-pet/web prepare  # Regenerate styled-system/ (run after panda.config.ts changes)
pnpm --filter @saving-pet/web studio   # Panda CSS design tokens studio
```

## Architecture

**Monorepo** using pnpm workspaces (no Turbo task runner at the workspace level—scripts call `pnpm -r` or `pnpm --filter` directly).

- `apps/web` — Next.js 15 (App Router, Turbopack) frontend
- `apps/api` — Go REST API backend

## Styling: Panda CSS + CVA

All styles live in `*.recipe.ts` files using Panda CSS's `cva` helper. The generated `styled-system/` directory (aliased as `$styled-system/*`) is committed and must be regenerated after config changes.

**One component, one recipe file** — never combine multiple components' styles in one `.recipe.ts`.

```ts
// Button.recipe.ts
import { cva } from "$styled-system/css";
export const buttonRecipe = cva({ base: { ... }, variants: { ... } });

// Button.tsx
import { buttonRecipe } from "./Button.recipe";
export function Button({ variant }) {
  return <button className={buttonRecipe({ variant })} />;
}
```

Recipe files (`*.recipe.ts`) never get `"use client"`.

## Server / Client Component Boundary

Default to **Server Components**. Add `"use client"` only when the component uses:
- React hooks (`useState`, `useEffect`, `usePathname`, etc.)
- Browser APIs
- Client-only libraries (`@base-ui/react`, `motion/react`)
- Interactive event handlers (`onClick`, etc.)

When a component is partly static and partly interactive, split it co-located and push `"use client"` to the leaf:

```
BottomNav/
  BottomNav.tsx       ← Server (container)
  BottomNavLink.tsx   ← "use client" (usePathname)
```

## Directory Structure (`apps/web/src`)

```
app/(main)/
  _layout/          # Components shared across multiple pages in (main)
                    # e.g. SubPageLayout, DecorativeBackground, DrawerStep
  _components/      # Home page-specific components
                    # e.g. HomeHeader, SavingsHero, SavingsEntryDrawer
  _features/        # Cross-page feature components
                    # e.g. _features/history/RecentRecords, RecordCard
  goal/             # Page-scoped components live directly under their page dir
  history/
  settings/

components/
  primitives/       # Route-agnostic UI primitives (Button, Input, etc.)
  layout/           # Route-agnostic reusable layout elements
```

Keep hierarchy to **2–3 levels**. Each level has an `index.ts` barrel export; prefer importing through barrels.

## Path Aliases

- `@/*` → `apps/web/src/*`
- `$styled-system/*` → `apps/web/styled-system/*` (generated by Panda CSS)

## Key Libraries

| Library | Purpose |
|---------|---------|
| `@base-ui/react` | Headless interactive primitives (dialogs, selects, etc.) |
| `motion` (`motion/react`) | Animations |
| `lucide-react` | Icons |
| `@pandacss/dev` | Panda CSS (utility-first, type-safe styling) |
